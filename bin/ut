#!/bin/bash

HBASE_HOME=$HOME/apache/hbase
UT_NAME=''
TIMES=''
OUTPUT=''
MVN_CMD=''
CURRENT_OUTPUT=''
if [ "$1" == "" ] || [ "$2" == "" ] || [ "$3" == "" ]; then
  echo "[USAGE] <UT> <TIMES> <OUTPUT>"
  exit
else
  UT_NAME=$1
  TIMES=$2
  OUTPUT=$3
  MVN_CMD="mvn clean test -Dtest="$UT_NAME" -P skipSparkTests"
fi
cd $HBASE_HOME
i=0
while [ "${i}" != "$TIMES" ]
do
  CURRENT_OUTPUT=$OUTPUT/$i
  mkdir $CURRENT_OUTPUT
  mvn clean test -Dtest=$UT_NAME -P skipSparkTests | tee $CURRENT_OUTPUT/console
  cp -r $HBASE_HOME/hbase-server/target/surefire-reports $CURRENT_OUTPUT/
  i=$(($i+1))
done
